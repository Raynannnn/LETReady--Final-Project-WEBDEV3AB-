<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Main Site</title>

<style>
*{ box-sizing:border-box; font-family:Arial, sans-serif; }
body{ margin:0; background:#1a3cff; min-height:100vh; color:white; }

/* HEADER */
.header{ text-align:center; padding:25px 0; font-weight:900; letter-spacing:1px; }

/* MAIN LAYOUT */
.container{ width:100%; display:flex; gap:30px; padding:30px 40px; align-items:flex-start; }

/* COMMON BOX */
.box{
  background:white; padding:20px; border-radius:15px; border:3px solid #1a3cff;
  box-shadow:0 5px 15px rgba(0,0,255,0.15); color:#1a3cff;
}

/* LEFT */
.left{ width:28%; display:flex; flex-direction:column; gap:25px; }

.create-box{ cursor:pointer; }

.create-box h3{ margin:0 0 8px; font-weight:900; }
.create-box p{ font-size:14px; opacity:0.8; }

.pending-title{ font-weight:900; margin-bottom:10px; }
.pending-list{ display:flex; flex-direction:column; gap:8px; }

.btn{
  padding:10px; border-radius:10px; border:2px solid #1a3cff; background:white;
  color:#1a3cff; font-weight:800; cursor:pointer; transition:0.3s;
}
.btn:hover{ background:#1a3cff; color:white; }

/* CENTER */
.center{
  width:44%;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:20px;
}
.card{
  min-height:170px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  font-weight:900;
  border-radius:15px;
  background:#f0f4ff;
  box-shadow:0 8px 25px rgba(0,0,255,0.1);
  padding:15px;
  text-align:center;
}
.stars{ margin-top:8px; color:#f2b01e; font-size:18px; }

/* RIGHT */
.right{ width:22%; display:flex; flex-direction:column; align-items:center; gap:18px; }
.profile-img{ width:90px; height:90px; border-radius:50%; background:#1a3cff; border:4px solid white; }
.profile-name{ width:100%; text-align:center; padding:12px; font-weight:900; }

.right .box button{ width:100%; margin-top:8px; }

/* BACK BUTTON */
.back-btn{ width:100%; margin-top:10px; }

/* PARTICLES */
#particles{ position:fixed; inset:0; z-index:-1; }
.particle{ position:absolute; width:5px; height:5px; background:white; opacity:0.5; border-radius:50%; animation: float 6s linear infinite; }
@keyframes float{ from{transform:translateY(100vh);} to{transform:translateY(-10vh);} }

.card-actions{
  display:flex;
  gap:8px;
  margin-top:10px;
}

.card-actions button{
  flex:1;
  padding:6px;
  border:none;
  border-radius:10px;
  font-size:12px;
  font-weight:700;
  cursor:pointer;
}

.edit-btn{
  background:#f2b01e;
  color:white;
}

.delete-btn{
  background:#ff5959;
  color:white;
}

.card-actions button:hover{
  opacity:0.85;
}

</style>
</head>

<body>

<div id="particles"></div>

<div class="header">
  <h2>THESIS REVIEWER PLATFORM</h2>
</div>

<div class="container">

  <!-- LEFT -->
  <div class="left">
    <div class="box create-box" onclick="location.href='create-subject.html'">
      <h3>Create a Reviewer</h3>
      <p>Start creating your own reviewer based on subject and difficulty</p>
    </div>

    <div>
      <div class="pending-title">Pending Projects</div>
      <div class="pending-list" id="pendingList"></div>
    </div>
  </div>

  <!-- CENTER -->
  <div class="center" id="reviewerCenter">
    <!-- Dynamically filled with reviewers -->
  </div>

  <!-- RIGHT -->
  <div class="right">
    <div class="profile-img"></div>
    <div class="box profile-name" id="NAME">Name</div>

    <div class="box">
      <h3 style="margin:0 0 10px;">Projects</h3>
      <div id="projectsButtons"></div>
    </div>
<!-- ADMIN PANEL BUTTON -->
  <button class="btn" id="adminPanelBtn" style="display:none;">
    Admin Approval
  </button>
    <button class="btn back-btn" onclick="logout()">Back to Main Page</button>
  </div>

</div>

<script>
/* PARTICLES */
for(let i=0;i<35;i++){
  let p=document.createElement("div");
  p.className="particle";
  p.style.left=Math.random()*100+"%";
  p.style.animationDuration=4+Math.random()*5+"s";
  document.getElementById("particles").appendChild(p);
}

/* LOAD USERS */
let user = JSON.parse(localStorage.getItem("currentUser"));

if(user){
  document.getElementById("NAME").innerText =
    user.role === "organization" ? user.fullOrgName : user.fullname;
}

// SHOW ADMIN PANEL BUTTON IF ADMIN
let adminBtn = document.getElementById("adminPanelBtn");

if(user && user.role === "admin"){
  adminBtn.style.display = "block";

  adminBtn.onclick = ()=>{
    location.href = "../admin.html";
  };
}


/* LOAD REVIEWERS + SCORES */
let reviewers = JSON.parse(localStorage.getItem("reviewers")) || [];
let scores = JSON.parse(localStorage.getItem("reviewerScores")) || [];

reviewers.forEach((r,i)=>{
  let c = document.createElement("div");
  c.className = "card";

  let related = scores.filter(s => s.reviewerIndex === i);
  let lastScore = related.length
    ? related[related.length - 1].score + " / " + related[related.length - 1].total
    : "No attempt";
  let attempts = related.length;

  c.innerHTML = `
    <b>${r.title}</b><br>
    ${r.subject} | ${r.difficulty}
    <div class="stars">â˜… â˜… â˜…</div>

    <div style="
      margin-top:8px;
      font-size:13px;
      background:#1a3cff;
      color:white;
      padding:6px 10px;
      border-radius:12px;
    ">
      Score: ${lastScore}<br>
      Attempts: ${attempts}
    </div>

    <div class="card-actions">
      <button class="edit-btn">Edit</button>
      <button class="delete-btn">Delete</button>
    </div>
  `;

  // ðŸ‘‰ OPEN REVIEWER (card click)
  c.onclick = ()=>{
    localStorage.setItem("activeReviewer", i);
    location.href = "../reviewer-view.html";
  };

  // ðŸ‘‰ EDIT
  c.querySelector(".edit-btn").onclick = (e)=>{
    e.stopPropagation(); // para di mag-open reviewer
    localStorage.setItem("editReviewerIndex", i);
    location.href = "create-questions.html";
  };

  // ðŸ‘‰ DELETE
  c.querySelector(".delete-btn").onclick = (e)=>{
    e.stopPropagation();

    if(confirm("Delete this reviewer?")){
      reviewers.splice(i,1);

      // delete related scores
      scores = scores.filter(s => s.reviewerIndex !== i);

      // reindex scores
      scores.forEach(s=>{
        if(s.reviewerIndex > i) s.reviewerIndex--;
      });

      localStorage.setItem("reviewers", JSON.stringify(reviewers));
      localStorage.setItem("reviewerScores", JSON.stringify(scores));
      location.reload();
    }
  };

  reviewerCenter.appendChild(c);
});


function logout(){
  localStorage.removeItem("currentUser");
  location.href="../index.html";
}
</script>

</body>
</html>
